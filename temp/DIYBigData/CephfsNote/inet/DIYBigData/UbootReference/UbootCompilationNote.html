<html>
  <head><title>U-boot Compilation</title></head>
  <body>
    <OL>
      <LI>U-boot source
<OL>
  <LI><a href="https://github.com/Xilinx/u-boot-xlnx" target="_b">Xilinx u-boot 
repository</a>. 
  <LI> Stephen Warren works on RPi support in mainline U-Boot. Some patches 
will appear in his work-in-progress repository before they get upstream. Can get his 
u-boot source by visiting this anchor: <a href="http://github.com/swarren/u-boot.git" 
target="_b">s warren u-boot source tree</a>.  
  <LI>The official u-boot source is here: 
<a href="ftp://ftp.denx.de/pub/u-boot/" target="_b">u-boot source</a>.
</OL>

<P> <b>Note: (08/21/2016)</b> (Via qemu-system-arm), 2015.07_u-boot can boot NixOS, 
    while 2016.01_u-boot fails to boot it. Don't know why. Worst of all, 
    <a href="http://wiki.qemu.org/ChangeLog/2.7#Known_issues" target="_b">Raspbian 
    kernels won't boot</a>

      <LI>We install binutils-arm-linux-gnueabihf, cpp-6-arm-linux-gnueabihf,
	g++-6-arm-linux-gnueabihf, gcc-6-arm-linux-gnueabihf,
	gcc-6-arm-linux-gnueabihf-base, 5 packages.
      <LI>Add one line in .profile
	<PRE>
export CROSS_COMPILE=/usr/bin/arm-linux-gnueabihf-
	</PRE>
      <LI> Configure u-boot for Rpi2
	<PRE>
$ make rpi_2_defconfig
  HOSTCC  scripts/basic/fixdep
/bin/sh: 1: cc: not found
scripts/Makefile.host:94: recipe for target 'scripts/basic/fixdep' failed
	</PRE>
      <LI> Install gcc (x86_64) so that we can compile scripts/basic/fixdep.c
	   to get fixdep.
	<PRE>
$ gcc -o  fixdep fixdep.c
	</PRE>
      <LI>Now, successfully generate .config
	<PRE>
$ make rpi_2_defconfig
  HOSTCC  scripts/basic/fixdep
  HOSTCC  scripts/kconfig/conf.o
  SHIPPED scripts/kconfig/zconf.tab.c
  SHIPPED scripts/kconfig/zconf.lex.c
  SHIPPED scripts/kconfig/zconf.hash.c
  HOSTCC  scripts/kconfig/zconf.tab.o
  HOSTLD  scripts/kconfig/conf
#
# configuration written to .config
#
	</PRE>

      <LI> $ make all 
	<PRE>
$ make all
make: arm-linux-gnueabihf-gcc: Command not found
/bin/sh: 1: arm-linux-gnueabihf-gcc: not found
dirname: missing operand
Try 'dirname --help' for more information.
scripts/kconfig/conf  --silentoldconfig Kconfig
  CHK     include/config.h
  UPD     include/config.h
  GEN     include/autoconf.mk
/bin/sh: 1: arm-linux-gnueabihf-gcc: not found
scripts/Makefile.autoconf:75: recipe for target 'include/autoconf.mk' failed
make[1]: *** [include/autoconf.mk] Error 1
make: *** No rule to make target 'include/config/auto.conf', needed by 'include/config/uboot.release'.  Stop.
	</PRE>
      <LI> $ export CROSS_COMPILE=/usr/bin/arm-linux-gnueabihf-; make all
	<PRE>
make: /usr/bin/arm-linux-gnueabihf-gcc: Command not found
/bin/sh: 1: /usr/bin/arm-linux-gnueabihf-gcc: not found
$ cd /usr/bin
$ sudo ln -s arm-linux-gnueabihf-gcc-5 arm-linux-gnueabihf-gcc
$ sudo ln -s arm-linux-gnueabihf-cpp-5 arm-linux-gnueabihf-cpp
$ cd /src3/Xvisor/u-boot
$ make all
	</PRE>
      <LI> Successfully built u-boot.bin
	<PRE>
$ ls -l u-boot.bin
-rw-r--r-- 1 hsu hsu 314844 Mar 28 19:42 u-boot.bin
$ file u-boot.bin
u-boot.bin: COM executable for DOS
$ ls  ../xvisor-next/docs/arm/bcm2836-raspi2-bootblk.bin.ift
../xvisor-next/docs/arm/bcm2836-raspi2-bootblk.bin.ift
$ cat ../xvisor-next/docs/arm/bcm2836-raspi2-bootblk.bin.ift u-boot.bin > u-boot.hyp 
$ ls -l u-boot.hyp
-rw-r--r-- 1 hsu hsu 347612 Mar 28 19:49 u-boot.hyp
$ cp u-boot.hyp /tmp; make clean; cp /tmp/u-boot.hyp . 
	</PRE>
    </OL>
  </body>
</html>
    

# Default setting


cat /etc/apt/sources.list.d/devuan-ceres.list 
# Devuan CERES (unstable suite)

deb http://tw.mirror.devuan.org/merged ceres main contrib
deb-src http://tw.mirror.devuan.org/merged ceres main contrib

cat /etc/apt/sources.list
# 

# deb cdrom:[Debian GNU/Linux 1.0-final _Jessie_ - Official amd64 DVD Binary-1 20170522-03:57]/ jessie main contrib non-free

#deb cdrom:[Debian GNU/Linux 1.0-final _Jessie_ - Official amd64 DVD Binary-1 20170522-03:57]/ jessie main contrib non-free

# jessie-security, previously known as 'volatile'
# A network mirror was not selected during install.  The following entries
# are provided as examples, but you should amend them as appropriate
# for your mirror of choice.
#
deb http://tw.mirror.devuan.org/merged/ jessie-security main contrib non-free
deb-src http://tw.mirror.devuan.org/merged jessie-security main contrib non-free

# jessie-updates, previously known as 'volatile'
# A network mirror was not selected during install.  The following entries
# are provided as examples, but you should amend them as appropriate
# for your mirror of choice.
#
deb http://tw.mirror.devuan.org/merged/ jessie-updates main contrib non-free
deb-src http://tw.mirror.devuan.org/merged jessie-updates main contrib non-free

deb http://tw.mirror.devuan.org/merged/ jessie main contrib non-free
deb-src http://tw.mirror.devuan.org/merged jessie main contrib non-free

cat /etc/apt/preferences.d/avoid-systemd 
Package: systemd-sysv
Pin: release *
Pin-Priority: -1

Package: libsystemd0
Pin: release *
Pin-Priority: -1

Package: *systemd*
Pin: release *
Pin-Priority: -1

cat /etc/apt/preferences.d/keep-libc 
Package: libc6
Pin: release a=stable
Pin-Priority: 2000

Package: openssh*
Pin: release a=stable
Pin-Priority: 2000

Package: *
Pin: release a=stable
Pin-Priority: 900

cat /etc/lsb-release
DISTRIB_ID=Debian GNU/Linux
DISTRIB_CODENAME=jessie


# Before using armbian

sudo aptitude install wget ca-certificates device-tree-compiler pv bc lzop zip binfmt-support build-essential ccache debootstrap ntpdate \
	gawk gcc-arm-linux-gnueabihf gcc-arm-linux-gnueabi qemu-user-static u-boot-tools uuid-dev zlib1g-dev unzip libusb-1.0-0-dev ntpdate \
	parted pkg-config libncurses5-dev whiptail debian-keyring debian-archive-keyring f2fs-tools libfile-fcntllock-perl rsync libssl-dev \
	nfs-kernel-server btrfs-tools gcc-aarch64-linux-gnu ncurses-term p7zip-full dos2unix dosfstools libc6-dev-armhf-cross libc6-dev-armel-cross \
	libc6-dev-arm64-cross curl gcc-arm-none-eabi libnewlib-arm-none-eabi patchutils python liblz4-tool libpython2.7-dev


select as this

he following packages will be DOWNGRADED:
  libexpat1 
The following NEW packages will be installed:
  binfmt-support binutils{a} binutils-aarch64-linux-gnu{a} binutils-arm-linux-gnueabi{a} binutils-arm-linux-gnueabihf{a} 
  binutils-arm-none-eabi{a} btrfs-tools build-essential ccache cpp{a} cpp-4.9{a} cpp-6-aarch64-linux-gnu{a} 
  cpp-6-arm-linux-gnueabi{a} cpp-6-arm-linux-gnueabihf{a} cpp-aarch64-linux-gnu{a} cpp-arm-linux-gnueabi{a} 
  cpp-arm-linux-gnueabihf{a} curl debian-keyring debootstrap device-tree-compiler dos2unix dosfstools dpkg-dev{a} f2fs-tools 
  fakeroot{a} g++{a} g++-4.9{a} gawk gcc{a} gcc-4.9{a} gcc-6-aarch64-linux-gnu{a} gcc-6-aarch64-linux-gnu-base{a} 
  gcc-6-arm-linux-gnueabi{a} gcc-6-arm-linux-gnueabi-base{a} gcc-6-arm-linux-gnueabihf{a} gcc-6-arm-linux-gnueabihf-base{a} 
  gcc-6-cross-base{a} gcc-7-base{a} gcc-aarch64-linux-gnu gcc-arm-linux-gnueabi gcc-arm-linux-gnueabihf gcc-arm-none-eabi 
  libalgorithm-diff-perl{a} libalgorithm-diff-xs-perl{a} libalgorithm-merge-perl{a} libasan1{a} libasan3-arm64-cross{a} 
  libasan3-armel-cross{a} libasan3-armhf-cross{a} libatomic1{a} libatomic1-arm64-cross{a} libatomic1-armel-cross{a} 
  libatomic1-armhf-cross{a} libc-dev-bin{a} libc6-arm64-cross{a} libc6-armel-cross{a} libc6-armhf-cross{a} libc6-dev{a} 
  libc6-dev-arm64-cross libc6-dev-armel-cross libc6-dev-armhf-cross libcc1-0{a} libcilkrts5{a} libcloog-isl4{a} libcurl3{a} 
  libdpkg-perl{a} libexpat1-dev{a} libfakeroot{a} libfile-fcntllock-perl libgcc-4.9-dev{a} libgcc-6-dev-arm64-cross{a} 
  libgcc-6-dev-armel-cross{a} libgcc-6-dev-armhf-cross{a} libgcc1-arm64-cross{a} libgcc1-armel-cross{a} libgcc1-armhf-cross{a} 
  libgomp1-arm64-cross{a} libgomp1-armel-cross{a} libgomp1-armhf-cross{a} libisl10{a} libisl15{a} libitm1{a} 
  libitm1-arm64-cross{a} liblsan0{a} liblz4-1{a} liblz4-tool liblzo2-2{a} libmpc3{a} libmpfr4{a} libncurses5-dev 
  libnewlib-arm-none-eabi libnewlib-dev{a} libparted2{a} libpython2.7{a} libpython2.7-dev libquadmath0{a} libssl-dev 
  libssl-doc{a} libstdc++-4.9-dev{a} libstdc++-arm-none-eabi-newlib{a} libstdc++6-arm64-cross{a} libstdc++6-armel-cross{a} 
  libstdc++6-armhf-cross{a} libtinfo-dev{a} libtsan0{a} libubsan0{a} libubsan0-arm64-cross{a} libubsan0-armel-cross{a} 
  libubsan0-armhf-cross{a} libusb-1.0-0-dev libusb-1.0-doc{a} linux-libc-dev{a} linux-libc-dev-arm64-cross{a} 
  linux-libc-dev-armel-cross{a} linux-libc-dev-armhf-cross{a} lockfile-progs{a} lzop make{a} manpages-dev{a} nfs-kernel-server 
  ntpdate p7zip-full parted patchutils pkg-config pv qemu-user-static rsync u-boot-tools unzip uuid-dev zip zlib1g-dev 
The following packages will be upgraded:
  libstdc++6 
1 packages upgraded, 134 newly installed, 1 downgraded, 0 to remove and 16 not upgraded.
Need to get 260 MB of archives. After unpacking 998 MB will be used.
Do you want to continue? [Y/n/?] 


# Run Armbina
cp lib/compile.sh .
./compile.sh




# What I change in armbian source

1. odroid xu4 kernel : lib/config/kernel/linux-odroidxu4-next.config

I turn on rbd, ceph, kvm, hyp, virtio, vhost modules

2.odroid xu4 u-boot bootloader : config/sources/odroidxu4.conf

Remove the scripts which lock u-boot version as 2012.07

# USE LEGACY UBOOT for both kernels to secure proper eMMC booting, until mainline u-boot get this function
#BOOTSOURCE='https://github.com/hardkernel/u-boot.git'
#BOOTBRANCH='branch:odroidxu3-v2012.07'
#BOOTSCRIPT='boot-odroid-xu4-default.ini:boot.ini'
#BOOTDIR='u-boot-odroidxu'
#BOOTPATCHDIR='u-boot-odroidxu4-default'
#UBOOT_TARGET_MAP=';;sd_fuse/hardkernel/bl1.bin.hardkernel sd_fuse/hardkernel/bl2.bin.hardkernel u-boot.bin sd_fuse/hardkernel/tzsw.bin.hardkernel'
#BOOTENV_FILE='odroidxu4-next.txt'
#UBOOT_USE_GCC='< 4.9'
#HAS_UUID_SUPPORT=yes
#BOOTCONFIG=odroid_config
# USE LEGACY UBOOT for both kernels to secure proper eMMC booting, until mainline u-boot get this function


3.Devuan OS install packages : lib/configuration.sh

Remove libpem-systemd package from value : PACKAGE_LIST_ADDITIONAL

4. OS support for Armbian : lib/general.sh

Add jessie codename into script

replace

if [[ -z $codename || "trusty xenial" != *"$codename"* ]]; then
   exit_with_error "It seems you ignore documentation and run an unsupported build system: ${codename:-(unknown)}"
fi

to

if [[ -z $codename || "trusty xenial jessie" != *"$codename"* ]]; then
   exit_with_error "It seems you ignore documentation and run an unsupported build system: ${codename:-(unknown)}"
fi

5. Add local kernel patch : userpatches/kernel/odroidxu4-next/HYP_Timer_4.9.30.patch

This patch let odroid xu4 can setup cpu into HYP mode

6. Add local mirror and Armbian image size : userpatches/lib.config


FIXED_IMAGE_SIZE='2044'
DEBIAN_MIRROR='auto.mirror.devuan.org/merged'
